!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t=t||self).JcampConverter={})}(this,(function(t){"use strict";const r=["TIC",".RIC","SCANNUMBER"];function e(t){let e=t.spectra,n=e.length,o={times:new Array(n),series:{ms:{dimension:2,data:new Array(n)}}},i=[];for(let t=0;t<r.length;t++){let l=a(r[t]);e[0][l]&&(i.push(l),o.series[l]={dimension:1,data:new Array(n)})}for(let t=0;t<n;t++){let r=e[t];o.times[t]=r.pageValue;for(let e=0;e<i.length;e++)o.series[i[e]].data[t]=parseFloat(r[i[e]]);r.data&&(o.series.ms.data[t]=[r.data.x,r.data.y])}t.chromatogram=o}function n(t){return-1!==r.indexOf(t)}function a(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function o(t){let r=[];for(let e=0;e<t.length;e++)r.push(parseFloat(t[e]));return r}function i(t,r){let e=t.yFactor,n=t.deltaX;t.isXYdata=!0;let a={x:[],y:[]};t.data=a;let o,i=t.firstX,l=t.firstY,f=!1,s=0;for(;s<r.length;s++)if(o=r.charCodeAt(s),13===o||10===o)f=!0;else if(f)break;let u=!0,c=!1,h=!1,p=0,d=!1,v=!1,g=0,m=0,y=!1,w=!1,A=!1,b=0;for(;s<=r.length;s++)if(o=s===r.length?13:r.charCodeAt(s),v)13!==o&&10!==o||(u=!0,v=!1);else if(o<=57&&o>=48)w=!0,b>0?g+=(o-48)/Math.pow(10,b++):(g*=10,g+=o-48);else if(44===o||46===o)w=!0,b++;else{if(w){if(u)u=!1,h&&(A=!0);else if(A)A=!1;else{c?(p=y?0-g:g,h=!0,c=!1):d||(m=y?0-g:g);let t=d?g-1:1;for(let r=0;r<t;r++)h?l+=p:l=m,a.x.push(i),a.y.push(l*e),i+=n}y=!1,g=0,b=0,w=!1,d=!1}if(o<74&&o>63)w=!0,h=!1,g=o-64;else if(o>96&&o<106)w=!0,h=!1,g=o-96,y=!0;else if(115===o)w=!0,d=!0,g=9;else if(o>82&&o<91)w=!0,d=!0,g=o-82;else if(o>73&&o<83)w=!0,c=!0,g=o-73;else if(o>105&&o<115)w=!0,c=!0,g=o-105,y=!0;else if(36===o&&36===r.charCodeAt(s+1))w=!0,v=!0;else if(37===o)w=!0,c=!0,g=0,y=!1;else if(45===o){let t=r.charCodeAt(s+1);(t>=48&&t<=57||44===t||46===t)&&(w=!0,u||(h=!1),y=!0)}else 13!==o&&10!==o||(u=!0,v=!1)}}const l=/\$\$.*/,f=/[,\t ]+/;function s(t,r,e){if(t.isPeaktable=!0,t.variables&&2!==Object.keys(t.variables)?function(t,r,e){let n={},a=Object.keys(t.variables),o=a.length;a.forEach(t=>n[t]=[]),t.data=n;let i=r.split(/,? *,?[;\r\n]+ */);for(let t=1;t<i.length;t++){let r=i[t].trim().replace(l,"").split(f);if(r.length%o==0)for(let t=0;t<r.length;t++)n[a[t%o]].push(parseFloat(r[t]));else e.logs.push("Format error: "+r)}}(t,r,e):function(t,r,e){let n={x:[],y:[]};t.data=n;let a=r.split(/,? *,?[;\r\n]+ */);for(let r=1;r<a.length;r++){let o=a[r].trim().replace(l,"").split(f);if(o.length%2==0)for(let r=0;r<o.length;r+=2)n.x.push(parseFloat(o[r])*t.xFactor),n.y.push(parseFloat(o[r+1])*t.yFactor);else e.logs.push("Format error: "+o)}}(t,r,e),t.variables)for(let r in t.variables)t.variables[r].data=t.data[r]}function u(t,r){let e,n=/(\(+|\)+|<+|>+|\s+)/g;t.isXYAdata=!0;let a={x:[],y:[]};t.data=a;let o=r.split(/,? *,?[;\r\n]+ */);for(let t=1;t<o.length;t++)e=o[t].trim().replace(n,"").split(","),a.x.push(parseFloat(e[0])),a.y.push(parseFloat(e[1]))}const c=Object.prototype.toString;var h=function(t){return c.call(t).endsWith("Array]")},p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function d(t,r){return t(r={exports:{}},r.exports),r.exports}var v=d((function(t){!function(){function r(t){for(var r=0,a=t.length-1,o=void 0,i=void 0,l=void 0,f=n(r,a);;){if(a<=r)return t[f];if(a==r+1)return t[r]>t[a]&&e(t,r,a),t[f];for(t[o=n(r,a)]>t[a]&&e(t,o,a),t[r]>t[a]&&e(t,r,a),t[o]>t[r]&&e(t,o,r),e(t,o,r+1),i=r+1,l=a;;){do{i++}while(t[r]>t[i]);do{l--}while(t[l]>t[r]);if(l<i)break;e(t,i,l)}e(t,r,l),l<=f&&(r=i),l>=f&&(a=l-1)}}var e=function(t,r,e){var n;return n=[t[e],t[r]],t[r]=n[0],t[e]=n[1],n},n=function(t,r){return~~((t+r)/2)};t.exports?t.exports=r:window.median=r}()}));function g(t){if(!h(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");return v(t.slice())}function m(t,r){let e=function(t){let r=t[0].data.y[0],e=r,n=t.length,a=t[0].data.x.length,o=new Array(n);for(let i=0;i<n;i++){o[i]=t[i].data.y;for(let t=0;t<a;t++){let n=o[i][t];n<r&&(r=n),n>e&&(e=n)}}const i=t[0].data.x[0],l=t[0].data.x[t[0].data.x.length-1],f=t[0].pageValue,s=t[n-1].pageValue;if(i>l)for(let t of o)t.reverse();return f>s&&o.reverse(),{z:o,minX:Math.min(i,l),maxX:Math.max(i,l),minY:Math.min(f,s),maxY:Math.max(f,s),minZ:r,maxZ:e,noise:g(o[0].map(Math.abs))}}(t.spectra);r.noContour||(t.contourLines=function(t,r){let e,n,a,o,i,l,f,s,u,c,h,p,d,v=t.noise,g=t.z,m=g.length,y=g[0].length,w=t.minX,A=(t.maxX-w)/(y-1),b=t.minY,M=(t.maxY-b)/(m-1),x=t.minZ,S=t.maxZ,F=2*r.nbContourLevels,E=new Array(F);for(let t=0;t<F;t++){let F={};E[t]=F;let T=t%2,X=(S-r.noiseMultiplier*v)*Math.exp((t>>1)-r.nbContourLevels);d=0===T?X+r.noiseMultiplier*v:0-X-r.noiseMultiplier*v;let O=[];if(F.zValue=d,F.lines=O,!(d<=x||d>=S))for(let t=0;t<m-1;t++){let r=g[t],v=g[t+1];for(let g=0;g<y-1;g++)e=r[g],n=r[g+1],a=v[g],o=v[g+1],i=e>d,l=n>d,f=a>d,s=o>d,i!==l&&i!==f&&(u=g+(d-e)/(n-e),c=t,h=g,p=t+(d-e)/(a-e),O.push(u*A+w),O.push(c*M+b),O.push(h*A+w),O.push(p*M+b)),s!==l&&s!==f&&(u=g+1,c=t+1-(d-o)/(n-o),h=g+1-(d-o)/(a-o),p=t+1,O.push(u*A+w),O.push(c*M+b),O.push(h*A+w),O.push(p*M+b)),l!==f&&(u=(g+1-(d-n)/(a-n))*A+w,c=(t+(d-n)/(a-n))*M+b,l!==i&&(h=g+1-(d-n)/(e-n),p=t,O.push(u),O.push(c),O.push(h*A+w),O.push(p*M+b)),f!==i&&(h=g,p=t+1-(d-a)/(e-a),O.push(u),O.push(c),O.push(h*A+w),O.push(p*M+b)),l!==s&&(h=g+1,p=t+(d-n)/(o-n),O.push(u),O.push(c),O.push(h*A+w),O.push(p*M+b)),f!==s&&(h=g+(d-a)/(o-a),p=t+1,O.push(u),O.push(c),O.push(h*A+w),O.push(p*M+b)))}}return{minX:t.minX,maxX:t.maxX,minY:t.minY,maxY:t.maxY,segments:E}}(e,r),delete e.z),t.minMax=e}function y(t,r,e){t.profiling&&t.profiling.push({action:r,time:Date.now()-e.start})}function w(t){let r=t.spectra[0].data;t.chromatogram={times:r.x.slice(),series:{intensity:{dimension:1,data:r.y.slice()}}}}var A=Object.prototype.toString,b=function(t){var r=A.call(t),e="[object Arguments]"===r;return e||(e="[object Array]"!==r&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===A.call(t.callee)),e},M=Object.prototype.hasOwnProperty,x=Object.prototype.toString,S=Array.prototype.slice,F=Object.prototype.propertyIsEnumerable,E=!F.call({toString:null},"toString"),T=F.call((function(){}),"prototype"),X=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],O=function(t){var r=t.constructor;return r&&r.prototype===t},N={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},k=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!N["$"+t]&&M.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{O(window[t])}catch(t){return!0}}catch(t){return!0}return!1}(),C=function(t){var r=null!==t&&"object"==typeof t,e="[object Function]"===x.call(t),n=b(t),a=r&&"[object String]"===x.call(t),o=[];if(!r&&!e&&!n)throw new TypeError("Object.keys called on a non-object");var i=T&&e;if(a&&t.length>0&&!M.call(t,0))for(var l=0;l<t.length;++l)o.push(String(l));if(n&&t.length>0)for(var f=0;f<t.length;++f)o.push(String(f));else for(var s in t)i&&"prototype"===s||!M.call(t,s)||o.push(String(s));if(E)for(var u=function(t){if("undefined"==typeof window||!k)return O(t);try{return O(t)}catch(t){return!1}}(t),c=0;c<X.length;++c)u&&"constructor"===X[c]||!M.call(t,X[c])||o.push(X[c]);return o};C.shim=function(){if(Object.keys){if(!function(){return 2===(Object.keys(arguments)||"").length}(1,2)){var t=Object.keys;Object.keys=function(r){return b(r)?t(S.call(r)):t(r)}}}else Object.keys=C;return Object.keys||C};var Y=C,D=(Y.shim(),{Int8Array:null,Uint8Array:null,Uint8ClampedArray:null,Int16Array:null,Uint16Array:null,Int32Array:null,Uint32Array:null,Float32Array:null,Float64Array:null});!function(){var t,r,e=Y(D),n=e.length;for(r=0;r<n;r++)t=e[r],D[t]=new Function("arr","return new "+t+"( arr );")}();d((function(t,r){!function(t){function r(t,r){return t<r?-1:t>r?1:t>=r?0:NaN}function e(t){var e;return 1===t.length&&(e=t,t=function(t,n){return r(e(t),n)}),{left:function(r,e,n,a){for(null==n&&(n=0),null==a&&(a=r.length);n<a;){var o=n+a>>>1;t(r[o],e)<0?n=o+1:a=o}return n},right:function(r,e,n,a){for(null==n&&(n=0),null==a&&(a=r.length);n<a;){var o=n+a>>>1;t(r[o],e)>0?a=o:n=o+1}return n}}}var n=e(r),a=n.right,o=n.left;function i(t){return null===t?NaN:+t}function l(t,r){var e,n,a=t.length,o=0,l=0,f=-1,s=0;if(null==r)for(;++f<a;)isNaN(e=i(t[f]))||(l+=(n=e-o)*(e-(o+=n/++s)));else for(;++f<a;)isNaN(e=i(r(t[f],f,t)))||(l+=(n=e-o)*(e-(o+=n/++s)));if(s>1)return l/(s-1)}function f(t,r){var e=l(t,r);return e?Math.sqrt(e):e}function s(t,r){var e,n,a,o=-1,i=t.length;if(null==r){for(;++o<i;)if(null!=(n=t[o])&&n>=n){e=a=n;break}for(;++o<i;)null!=(n=t[o])&&(e>n&&(e=n),a<n&&(a=n))}else{for(;++o<i;)if(null!=(n=r(t[o],o,t))&&n>=n){e=a=n;break}for(;++o<i;)null!=(n=r(t[o],o,t))&&(e>n&&(e=n),a<n&&(a=n))}return[e,a]}function u(t){return function(){return t}}function c(t){return t}function h(t,r,e){t=+t,r=+r,e=(a=arguments.length)<2?(r=t,t=0,1):a<3?1:+e;for(var n=-1,a=0|Math.max(0,Math.ceil((r-t)/e)),o=new Array(a);++n<a;)o[n]=t+n*e;return o}var p=Math.sqrt(50),d=Math.sqrt(10),v=Math.sqrt(2);function g(t,r,e){var n=m(t,r,e);return h(Math.ceil(t/n)*n,Math.floor(r/n)*n+n/2,n)}function m(t,r,e){var n=Math.abs(r-t)/Math.max(0,e),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/a;return o>=p?a*=10:o>=d?a*=5:o>=v&&(a*=2),r<t?-a:a}function y(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1}function w(t){return+t}function A(t,r,e){if(null==e&&(e=i),n=t.length){if((r=+r)<=0||n<2)return+e(t[0],0,t);if(r>=1)return+e(t[n-1],n-1,t);var n,a=(n-1)*r,o=Math.floor(a),l=+e(t[o],o,t);return l+(+e(t[o+1],o+1,t)-l)*(a-o)}}function b(t,r){var e,n,a=-1,o=t.length;if(null==r){for(;++a<o;)if(null!=(n=t[a])&&n>=n){e=n;break}for(;++a<o;)null!=(n=t[a])&&e>n&&(e=n)}else{for(;++a<o;)if(null!=(n=r(t[a],a,t))&&n>=n){e=n;break}for(;++a<o;)null!=(n=r(t[a],a,t))&&e>n&&(e=n)}return e}function M(t){if(!(a=t.length))return[];for(var r=-1,e=b(t,x),n=new Array(e);++r<e;)for(var a,o=-1,i=n[r]=new Array(a);++o<a;)i[o]=t[o][r];return n}function x(t){return t.length}t.version="0.7.1",t.bisect=a,t.bisectRight=a,t.bisectLeft=o,t.ascending=r,t.bisector=e,t.descending=function(t,r){return r<t?-1:r>t?1:r>=t?0:NaN},t.deviation=f,t.extent=s,t.histogram=function(){var t=c,r=s,e=y;function n(n){var o,i,l=n.length,f=new Array(l);for(o=0;o<l;++o)f[o]=+t(n[o],o,n);var s=r(f),u=+s[0],c=+s[1],h=e(f,u,c);Array.isArray(h)||(h=g(u,c,+h));var p=h.length;for(o=0;o<p;++o)h[o]=+h[o];for(;h[0]<=u;)h.shift(),--p;for(;h[p-1]>=c;)h.pop(),--p;var d,v=new Array(p+1);for(o=0;o<=p;++o)(d=v[o]=[]).x0=o>0?h[o-1]:u,d.x1=o<p?h[o]:c;for(o=0;o<l;++o)u<=(i=f[o])&&i<=c&&v[a(h,i,0,p)].push(n[o]);return v}return n.value=function(r){return arguments.length?(t="function"==typeof r?r:u(+r),n):t},n.domain=function(t){return arguments.length?(r="function"==typeof t?t:u([+t[0],+t[1]]),n):r},n.thresholds=function(t){return arguments.length?(e="function"==typeof t?t:Array.isArray(t)?u(Array.prototype.map.call(t,w)):u(+t),n):e},n},t.thresholdFreedmanDiaconis=function(t,e,n){return t.sort(r),Math.ceil((n-e)/(2*(A(t,.75)-A(t,.25))*Math.pow(t.length,-1/3)))},t.thresholdScott=function(t,r,e){return Math.ceil((e-r)/(3.5*f(t)*Math.pow(t.length,-1/3)))},t.thresholdSturges=y,t.max=function(t,r){var e,n,a=-1,o=t.length;if(null==r){for(;++a<o;)if(null!=(n=t[a])&&n>=n){e=n;break}for(;++a<o;)null!=(n=t[a])&&n>e&&(e=n)}else{for(;++a<o;)if(null!=(n=r(t[a],a,t))&&n>=n){e=n;break}for(;++a<o;)null!=(n=r(t[a],a,t))&&n>e&&(e=n)}return e},t.mean=function(t,r){var e,n=0,a=t.length,o=-1,l=a;if(null==r)for(;++o<a;)isNaN(e=i(t[o]))?--l:n+=e;else for(;++o<a;)isNaN(e=i(r(t[o],o,t)))?--l:n+=e;if(l)return n/l},t.median=function(t,e){var n,a=[],o=t.length,l=-1;if(null==e)for(;++l<o;)isNaN(n=i(t[l]))||a.push(n);else for(;++l<o;)isNaN(n=i(e(t[l],l,t)))||a.push(n);return A(a.sort(r),.5)},t.merge=function(t){for(var r,e,n,a=t.length,o=-1,i=0;++o<a;)i+=t[o].length;for(e=new Array(i);--a>=0;)for(r=(n=t[a]).length;--r>=0;)e[--i]=n[r];return e},t.min=b,t.pairs=function(t){for(var r=0,e=t.length-1,n=t[0],a=new Array(e<0?0:e);r<e;)a[r]=[n,n=t[++r]];return a},t.permute=function(t,r){for(var e=r.length,n=new Array(e);e--;)n[e]=t[r[e]];return n},t.quantile=A,t.range=h,t.scan=function(t,e){if(n=t.length){var n,a,o=0,i=0,l=t[i];for(e||(e=r);++o<n;)(e(a=t[o],l)<0||0!==e(l,l))&&(l=a,i=o);return 0===e(l,l)?i:void 0}},t.shuffle=function(t,r,e){for(var n,a,o=(null==e?t.length:e)-(r=null==r?0:+r);o;)a=Math.random()*o--|0,n=t[o+r],t[o+r]=t[a+r],t[a+r]=n;return t},t.sum=function(t,r){var e,n=0,a=t.length,o=-1;if(null==r)for(;++o<a;)(e=+t[o])&&(n+=e);else for(;++o<a;)(e=+r(t[o],o,t))&&(n+=e);return n},t.ticks=g,t.tickStep=m,t.transpose=M,t.variance=l,t.zip=function(){return M(arguments)}}(r)})),d((function(t,r){(function(){var t,e="0.3.0",n="2013-03";(t=r).toString=function(){return"version "+e+", released "+n};for(var a=0,o=null,i=null,l={init:function(t){if(0===t||0!=(t&t-1))throw new Error("init: radix-2 required");a=t,l._initArray(),l._makeBitReversalTable(),l._makeCosSinTable()},fft1d:function(t,r){l.fft(t,r,1)},ifft1d:function(t,r){var e=1/a;l.fft(t,r,-1);for(var n=0;n<a;n++)t[n]*=e,r[n]*=e},bt1d:function(t,r){l.fft(t,r,-1)},fft2d:function(t,r){for(var e=[],n=[],o=0,i=0;i<a;i++){o=i*a;for(var f=0;f<a;f++)e[f]=t[f+o],n[f]=r[f+o];l.fft1d(e,n);for(var s=0;s<a;s++)t[s+o]=e[s],r[s+o]=n[s]}for(var u=0;u<a;u++){for(var c=0;c<a;c++)o=u+c*a,e[c]=t[o],n[c]=r[o];l.fft1d(e,n);for(var h=0;h<a;h++)t[o=u+h*a]=e[h],r[o]=n[h]}},ifft2d:function(t,r){for(var e=[],n=[],o=0,i=0;i<a;i++){o=i*a;for(var f=0;f<a;f++)e[f]=t[f+o],n[f]=r[f+o];l.ifft1d(e,n);for(var s=0;s<a;s++)t[s+o]=e[s],r[s+o]=n[s]}for(var u=0;u<a;u++){for(var c=0;c<a;c++)o=u+c*a,e[c]=t[o],n[c]=r[o];l.ifft1d(e,n);for(var h=0;h<a;h++)t[o=u+h*a]=e[h],r[o]=n[h]}},fft:function(t,r,e){for(var n,l,f,s,u,c,h,p,d,v=a>>2,g=0;g<a;g++)g<(s=o[g])&&(u=t[g],t[g]=t[s],t[s]=u,u=r[g],r[g]=r[s],r[s]=u);for(var m=1;m<a;m<<=1){l=0,n=a/(m<<1);for(var y=0;y<m;y++){c=i[l+v],h=e*i[l];for(var w=y;w<a;w+=m<<1)p=c*t[f=w+m]+h*r[f],d=c*r[f]-h*t[f],t[f]=t[w]-p,t[w]+=p,r[f]=r[w]-d,r[w]+=d;l+=n}}},_initArray:function(){o="undefined"!=typeof Uint32Array?new Uint32Array(a):[],i="undefined"!=typeof Float64Array?new Float64Array(1.25*a):[]},_paddingZero:function(){},_makeBitReversalTable:function(){var t=0,r=0,e=0;for(o[0]=0;++t<a;){for(e=a>>1;e<=r;)r-=e,e>>=1;r+=e,o[t]=r}},_makeCosSinTable:function(){var t=a>>1,r=a>>2,e=a>>3,n=t+r,o=Math.sin(Math.PI/a),l=2*o*o,f=Math.sqrt(l*(2-l)),s=i[r]=1,u=i[0]=0;o=2*l;for(var c=1;c<e;c++)l+=o*(s-=l),f-=o*(u+=f),i[c]=u,i[r-c]=s;0!==e&&(i[e]=Math.sqrt(.5));for(var h=0;h<r;h++)i[t-h]=i[h];for(var p=0;p<n;p++)i[p+t]=-i[p]}},f=["init","fft1d","ifft1d","fft2d","ifft2d"],s=0;s<f.length;s++)t[f[s]]=l[f[s]];return t.bt=l.bt1d,t.fft=l.fft1d,t.ifft=l.ifft1d,t}).call(p)}));var I=d((function(t,r){function e(t,r){return t-r}r.sum=function(t){for(var r=0,e=0;e<t.length;e++)r+=t[e];return r},r.max=function(t){for(var r=t[0],e=t.length,n=1;n<e;n++)t[n]>r&&(r=t[n]);return r},r.min=function(t){for(var r=t[0],e=t.length,n=1;n<e;n++)t[n]<r&&(r=t[n]);return r},r.minMax=function(t){for(var r=t[0],e=t[0],n=t.length,a=1;a<n;a++)t[a]<r&&(r=t[a]),t[a]>e&&(e=t[a]);return{min:r,max:e}},r.arithmeticMean=function(t){for(var r=0,e=t.length,n=0;n<e;n++)r+=t[n];return r/e},r.mean=r.arithmeticMean,r.geometricMean=function(t){for(var r=1,e=t.length,n=0;n<e;n++)r*=t[n];return Math.pow(r,1/e)},r.logMean=function(t){for(var r=0,e=t.length,n=0;n<e;n++)r+=Math.log(t[n]);return r/e},r.grandMean=function(t,r){for(var e=0,n=0,a=t.length,o=0;o<a;o++)e+=r[o]*t[o],n+=r[o];return e/n},r.truncatedMean=function(t,r,n){void 0===n&&(n=!1),n||(t=[].concat(t).sort(e));for(var a=t.length,o=Math.floor(a*r),i=0,l=o;l<a-o;l++)i+=t[l];return i/(a-2*o)},r.harmonicMean=function(t){for(var r=0,e=t.length,n=0;n<e;n++){if(0===t[n])throw new RangeError("value at index "+n+"is zero");r+=1/t[n]}return e/r},r.contraHarmonicMean=function(t){for(var r=0,e=0,n=t.length,a=0;a<n;a++)r+=t[a]*t[a],e+=t[a];if(e<0)throw new RangeError("sum of values is negative");return r/e},r.median=function(t,r){void 0===r&&(r=!1),r||(t=[].concat(t).sort(e));var n=t.length,a=Math.floor(n/2);return n%2==0?.5*(t[a-1]+t[a]):t[a]},r.variance=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),a=0,o=t.length,i=0;i<o;i++){var l=t[i]-n;a+=l*l}return e?a/(o-1):a/o},r.standardDeviation=function(t,e){return Math.sqrt(r.variance(t,e))},r.standardError=function(t){return r.standardDeviation(t)/Math.sqrt(t.length)},r.robustMeanAndStdev=function(t){var r=0,n=t.length,a=0;for(a=0;a<n;a++)r+=t[a];r/=n;var o=new Array(n);for(a=0;a<n;a++)o[a]=Math.abs(t[a]-r);return o.sort(e),{mean:r,stdev:n%2==1?o[(n-1)/2]/.6745:.5*(o[n/2]+o[n/2-1])/.6745}},r.quartiles=function(t,n){void 0===n&&(n=!1),n||(t=[].concat(t).sort(e));var a=t.length/4;return{q1:t[Math.ceil(a)-1],q2:r.median(t,!0),q3:t[Math.ceil(3*a)-1]}},r.pooledStandardDeviation=function(t,e){return Math.sqrt(r.pooledVariance(t,e))},r.pooledVariance=function(t,e){void 0===e&&(e=!0);for(var n=0,a=0,o=t.length,i=0;i<o;i++){var l=t[i],f=r.variance(l);n+=(l.length-1)*f,a+=e?l.length-1:l.length}return n/a},r.mode=function(t){var r,e=t.length,n=new Array(e);for(r=0;r<e;r++)n[r]=0;var a=new Array(e),o=0;for(r=0;r<e;r++){var i=a.indexOf(t[r]);i>=0?n[i]++:(a[o]=t[r],n[o]=1,o++)}var l=0,f=0;for(r=0;r<o;r++)n[r]>l&&(l=n[r],f=r);return a[f]},r.covariance=function(t,e,n){void 0===n&&(n=!0);var a=r.mean(t),o=r.mean(e);if(t.length!==e.length)throw"Vectors do not have the same dimensions";for(var i=0,l=t.length,f=0;f<l;f++){i+=(t[f]-a)*(e[f]-o)}return n?i/(l-1):i/l},r.skewness=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),a=0,o=0,i=t.length,l=0;l<i;l++){var f=t[l]-n;a+=f*f,o+=f*f*f}var s=a/i,u=o/i/Math.pow(s,1.5);return e?Math.sqrt(i*(i-1))/(i-2)*u:u},r.kurtosis=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),a=t.length,o=0,i=0,l=0;l<a;l++){var f=t[l]-n;o+=f*f,i+=f*f*f*f}var s=o/a;if(e){var u=o/(a-1);return a*(a+1)/((a-1)*(a-2)*(a-3))*(i/(u*u))-3*((a-1)*(a-1)/((a-2)*(a-3)))}return i/a/(s*s)-3},r.entropy=function(t,r){void 0===r&&(r=0);for(var e=0,n=t.length,a=0;a<n;a++)e+=t[a]*Math.log(t[a]+r);return-e},r.weightedMean=function(t,r){for(var e=0,n=t.length,a=0;a<n;a++)e+=t[a]*r[a];return e},r.weightedStandardDeviation=function(t,e){return Math.sqrt(r.weightedVariance(t,e))},r.weightedVariance=function(t,e){for(var n=r.weightedMean(t,e),a=0,o=t.length,i=0,l=0,f=0;f<o;f++){var s=t[f]-n,u=e[f];a+=u*(s*s),l+=u,i+=u*u}return a*(l/(l*l-i))},r.center=function(t,e){void 0===e&&(e=!1);var n=t;e||(n=[].concat(t));for(var a=r.mean(n),o=n.length,i=0;i<o;i++)n[i]-=a},r.standardize=function(t,e,n){void 0===e&&(e=r.standardDeviation(t)),void 0===n&&(n=!1);for(var a=t.length,o=n?t:new Array(a),i=0;i<a;i++)o[i]=t[i]/e;return o},r.cumulativeSum=function(t){var r=t.length,e=new Array(r);e[0]=t[0];for(var n=1;n<r;n++)e[n]=e[n-1]+t[n];return e}})),L=(I.sum,I.max,I.min,I.minMax,I.arithmeticMean,I.mean,I.geometricMean,I.logMean,I.grandMean,I.truncatedMean,I.harmonicMean,I.contraHarmonicMean,I.median,I.variance,I.standardDeviation,I.standardError,I.robustMeanAndStdev,I.quartiles,I.pooledStandardDeviation,I.pooledVariance,I.mode,I.covariance,I.skewness,I.kurtosis,I.entropy,I.weightedMean,I.weightedStandardDeviation,I.weightedVariance,I.center,I.standardize,I.cumulativeSum,d((function(t,r){function e(t,r){return t-r}r.max=function(t){for(var r=-1/0,e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)t[e][n]>r&&(r=t[e][n]);return r},r.min=function(t){for(var r=1/0,e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)t[e][n]<r&&(r=t[e][n]);return r},r.minMax=function(t){for(var r=1/0,e=-1/0,n=0;n<t.length;n++)for(var a=0;a<t[n].length;a++)t[n][a]<r&&(r=t[n][a]),t[n][a]>e&&(e=t[n][a]);return{min:r,max:e}},r.entropy=function(t,r){void 0===r&&(r=0);for(var e=0,n=t.length,a=t[0].length,o=0;o<n;o++)for(var i=0;i<a;i++)e+=t[o][i]*Math.log(t[o][i]+r);return-e},r.mean=function(t,r){void 0===r&&(r=0);var e,n,a,o,i=t.length,l=t[0].length;if(-1===r){for(e=[0],n=i*l,a=0;a<i;a++)for(o=0;o<l;o++)e[0]+=t[a][o];e[0]/=n}else if(0===r)for(e=new Array(l),n=i,o=0;o<l;o++){for(e[o]=0,a=0;a<i;a++)e[o]+=t[a][o];e[o]/=n}else{if(1!==r)throw new Error("Invalid dimension");for(e=new Array(i),n=l,o=0;o<i;o++){for(e[o]=0,a=0;a<l;a++)e[o]+=t[o][a];e[o]/=n}}return e},r.sum=function(t,r){void 0===r&&(r=0);var e,n,a,o=t.length,i=t[0].length;if(-1===r)for(e=[0],n=0;n<o;n++)for(a=0;a<i;a++)e[0]+=t[n][a];else if(0===r)for(e=new Array(i),a=0;a<i;a++)for(e[a]=0,n=0;n<o;n++)e[a]+=t[n][a];else{if(1!==r)throw new Error("Invalid dimension");for(e=new Array(o),a=0;a<o;a++)for(e[a]=0,n=0;n<i;n++)e[a]+=t[a][n]}return e},r.product=function(t,r){void 0===r&&(r=0);var e,n,a,o=t.length,i=t[0].length;if(-1===r)for(e=[1],n=0;n<o;n++)for(a=0;a<i;a++)e[0]*=t[n][a];else if(0===r)for(e=new Array(i),a=0;a<i;a++)for(e[a]=1,n=0;n<o;n++)e[a]*=t[n][a];else{if(1!==r)throw new Error("Invalid dimension");for(e=new Array(o),a=0;a<o;a++)for(e[a]=1,n=0;n<i;n++)e[a]*=t[a][n]}return e},r.standardDeviation=function(t,e,n){for(var a=r.variance(t,e,n),o=a.length,i=0;i<o;i++)a[i]=Math.sqrt(a[i]);return a},r.variance=function(t,e,n){void 0===n&&(n=!0),e=e||r.mean(t);var a=t.length;if(0===a)return[];for(var o=t[0].length,i=new Array(o),l=0;l<o;l++){for(var f=0,s=0,u=0,c=0;c<a;c++)f+=u=t[c][l]-e[l],s+=u*u;i[l]=n?(s-f*f/a)/(a-1):(s-f*f/a)/a}return i},r.median=function(t){for(var r=t.length,n=t[0].length,a=new Array(n),o=0;o<n;o++){for(var i=new Array(r),l=0;l<r;l++)i[l]=t[l][o];i.sort(e);var f=i.length;a[o]=f%2==0?.5*(i[f/2]+i[f/2-1]):i[Math.floor(f/2)]}return a},r.mode=function(t){var r,e,n=t.length,a=t[0].length,o=new Array(a);for(r=0;r<a;r++){for(var i=new Array(n),l=0;l<n;l++)i[l]=0;var f=new Array(n),s=0;for(e=0;e<n;e++){var u=f.indexOf(t[e][r]);u>=0?i[u]++:(f[s]=t[e][r],i[s]=1,s++)}var c=0,h=0;for(e=0;e<s;e++)i[e]>c&&(c=i[e],h=e);o[r]=f[h]}return o},r.skewness=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),a=t.length,o=n.length,i=new Array(o),l=0;l<o;l++){for(var f=0,s=0,u=0;u<a;u++){var c=t[u][l]-n[l];f+=c*c,s+=c*c*c}var h=f/a,p=s/a/Math.pow(h,1.5);if(e){var d=Math.sqrt(a*(a-1)),v=a-2;i[l]=d/v*p}else i[l]=p}return i},r.kurtosis=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),a=t.length,o=t[0].length,i=new Array(o),l=0;l<o;l++){for(var f=0,s=0,u=0;u<a;u++){var c=t[u][l]-n[l];f+=c*c,s+=c*c*c*c}var h=f/a,p=s/a;if(e){var d=f/(a-1),v=a*(a+1)/((a-1)*(a-2)*(a-3)),g=s/(d*d),m=(a-1)*(a-1)/((a-2)*(a-3));i[l]=v*g-3*m}else i[l]=p/(h*h)-3}return i},r.standardError=function(t){for(var e=t.length,n=r.standardDeviation(t),a=n.length,o=new Array(a),i=Math.sqrt(e),l=0;l<a;l++)o[l]=n[l]/i;return o},r.covariance=function(t,e){return r.scatter(t,void 0,e)},r.scatter=function(t,e,n){void 0===n&&(n=0),void 0===e&&(0===n?e=t.length-1:1===n&&(e=t[0].length-1));var a=r.mean(t,n),o=t.length;if(0===o)return[[]];var i,l,f,s,u,c=t[0].length;if(0===n){for(i=new Array(c),l=0;l<c;l++)i[l]=new Array(c);for(l=0;l<c;l++)for(f=l;f<c;f++){for(s=0,u=0;u<o;u++)s+=(t[u][f]-a[f])*(t[u][l]-a[l]);s/=e,i[l][f]=s,i[f][l]=s}}else{if(1!==n)throw new Error("Invalid dimension");for(i=new Array(o),l=0;l<o;l++)i[l]=new Array(o);for(l=0;l<o;l++)for(f=l;f<o;f++){for(s=0,u=0;u<c;u++)s+=(t[f][u]-a[f])*(t[l][u]-a[l]);s/=e,i[l][f]=s,i[f][l]=s}}return i},r.correlation=function(t){var e,n,a=r.mean(t),o=r.standardDeviation(t,!0,a),i=r.zScores(t,a,o),l=t.length,f=t[0].length,s=new Array(f);for(e=0;e<f;e++)s[e]=new Array(f);for(e=0;e<f;e++)for(n=e;n<f;n++){for(var u=0,c=0,h=i.length;c<h;c++)u+=i[c][n]*i[c][e];u/=l-1,s[e][n]=u,s[n][e]=u}return s},r.zScores=function(t,e,n){return e=e||r.mean(t),void 0===n&&(n=r.standardDeviation(t,!0,e)),r.standardize(r.center(t,e,!1),n,!0)},r.center=function(t,e,n){e=e||r.mean(t);var a,o,i,l=t,f=t.length;if(!n)for(l=new Array(f),a=0;a<f;a++)l[a]=new Array(t[a].length);for(a=0;a<f;a++){var s=l[a];for(o=0,i=s.length;o<i;o++)s[o]=t[a][o]-e[o]}return l},r.standardize=function(t,e,n){void 0===e&&(e=r.standardDeviation(t));var a,o,i,l=t,f=t.length;if(!n)for(l=new Array(f),a=0;a<f;a++)l[a]=new Array(t[a].length);for(a=0;a<f;a++){var s=l[a],u=t[a];for(o=0,i=s.length;o<i;o++)0===e[o]||isNaN(e[o])||(s[o]=u[o]/e[o])}return l},r.weightedVariance=function(t,e){var n=r.mean(t),a=t.length;if(0===a)return[];for(var o=t[0].length,i=new Array(o),l=0;l<o;l++){for(var f=0,s=0,u=0,c=0;c<a;c++){var h=t[c][l]-n[l],p=e[c];f+=p*(h*h),u+=p,s+=p*p}i[l]=f*(u/(u*u-s))}return i},r.weightedMean=function(t,r,e){void 0===e&&(e=0);var n=t.length;if(0===n)return[];var a,o,i,l,f,s,u=t[0].length;if(0===e){for(a=new Array(u),o=0;o<u;o++)a[o]=0;for(o=0;o<n;o++)for(s=t[o],f=r[o],l=0;l<u;l++)a[l]+=s[l]*f}else{if(1!==e)throw new Error("Invalid dimension");for(a=new Array(n),o=0;o<n;o++)a[o]=0;for(l=0;l<n;l++)for(s=t[l],f=r[l],o=0;o<u;o++)a[l]+=s[o]*f}var c=I.sum(r);if(0!==c)for(o=0,i=a.length;o<i;o++)a[o]/=c;return a},r.weightedCovariance=function(t,e,n,a){a=a||0,n=n||r.weightedMean(t,e,a);for(var o=0,i=0,l=0,f=e.length;l<f;l++)o+=e[l],i+=e[l]*e[l];var s=o/(o*o-i);return r.weightedScatter(t,e,n,s,a)},r.weightedScatter=function(t,e,n,a,o){o=o||0,n=n||r.weightedMean(t,e,o),void 0===a&&(a=1);var i=t.length;if(0===i)return[[]];var l,f,s,u,c,h=t[0].length;if(0===o){for(l=new Array(h),f=0;f<h;f++)l[f]=new Array(h);for(f=0;f<h;f++)for(s=f;s<h;s++){for(c=0,u=0;u<i;u++)c+=e[u]*(t[u][s]-n[s])*(t[u][f]-n[f]);l[f][s]=c*a,l[s][f]=c*a}}else{if(1!==o)throw new Error("Invalid dimension");for(l=new Array(i),f=0;f<i;f++)l[f]=new Array(i);for(f=0;f<i;f++)for(s=f;s<i;s++){for(c=0,u=0;u<h;u++)c+=e[u]*(t[s][u]-n[s])*(t[f][u]-n[f]);l[f][s]=c*a,l[s][f]=c*a}}return l}})));L.max,L.min,L.minMax,L.entropy,L.mean,L.sum,L.product,L.standardDeviation,L.variance,L.median,L.mode,L.skewness,L.kurtosis,L.standardError,L.covariance,L.scatter,L.correlation,L.zScores,L.center,L.standardize,L.weightedVariance,L.weightedMean,L.weightedCovariance,L.weightedScatter,d((function(t,r){(function(){var t,e="0.3.0",n="2013-03";(t=r).toString=function(){return"version "+e+", released "+n};for(var a=0,o=null,i=null,l={init:function(t){if(0===t||0!=(t&t-1))throw new Error("init: radix-2 required");a=t,l._initArray(),l._makeBitReversalTable(),l._makeCosSinTable()},fft1d:function(t,r){l.fft(t,r,1)},ifft1d:function(t,r){var e=1/a;l.fft(t,r,-1);for(var n=0;n<a;n++)t[n]*=e,r[n]*=e},bt1d:function(t,r){l.fft(t,r,-1)},fft2d:function(t,r){for(var e=[],n=[],o=0,i=0;i<a;i++){o=i*a;for(var f=0;f<a;f++)e[f]=t[f+o],n[f]=r[f+o];l.fft1d(e,n);for(var s=0;s<a;s++)t[s+o]=e[s],r[s+o]=n[s]}for(var u=0;u<a;u++){for(var c=0;c<a;c++)o=u+c*a,e[c]=t[o],n[c]=r[o];l.fft1d(e,n);for(var h=0;h<a;h++)t[o=u+h*a]=e[h],r[o]=n[h]}},ifft2d:function(t,r){for(var e=[],n=[],o=0,i=0;i<a;i++){o=i*a;for(var f=0;f<a;f++)e[f]=t[f+o],n[f]=r[f+o];l.ifft1d(e,n);for(var s=0;s<a;s++)t[s+o]=e[s],r[s+o]=n[s]}for(var u=0;u<a;u++){for(var c=0;c<a;c++)o=u+c*a,e[c]=t[o],n[c]=r[o];l.ifft1d(e,n);for(var h=0;h<a;h++)t[o=u+h*a]=e[h],r[o]=n[h]}},fft:function(t,r,e){for(var n,l,f,s,u,c,h,p,d,v=a>>2,g=0;g<a;g++)g<(s=o[g])&&(u=t[g],t[g]=t[s],t[s]=u,u=r[g],r[g]=r[s],r[s]=u);for(var m=1;m<a;m<<=1){l=0,n=a/(m<<1);for(var y=0;y<m;y++){c=i[l+v],h=e*i[l];for(var w=y;w<a;w+=m<<1)p=c*t[f=w+m]+h*r[f],d=c*r[f]-h*t[f],t[f]=t[w]-p,t[w]+=p,r[f]=r[w]-d,r[w]+=d;l+=n}}},_initArray:function(){o="undefined"!=typeof Uint32Array?new Uint32Array(a):[],i="undefined"!=typeof Float64Array?new Float64Array(1.25*a):[]},_paddingZero:function(){},_makeBitReversalTable:function(){var t=0,r=0,e=0;for(o[0]=0;++t<a;){for(e=a>>1;e<=r;)r-=e,e>>=1;r+=e,o[t]=r}},_makeCosSinTable:function(){var t=a>>1,r=a>>2,e=a>>3,n=t+r,o=Math.sin(Math.PI/a),l=2*o*o,f=Math.sqrt(l*(2-l)),s=i[r]=1,u=i[0]=0;o=2*l;for(var c=1;c<e;c++)l+=o*(s-=l),f-=o*(u+=f),i[c]=u,i[r-c]=s;0!==e&&(i[e]=Math.sqrt(.5));for(var h=0;h<r;h++)i[t-h]=i[h];for(var p=0;p<n;p++)i[p+t]=-i[p]}},f=["init","fft1d","ifft1d","fft2d","ifft2d"],s=0;s<f.length;s++)t[f[s]]=l[f[s]];return t.bt=l.bt1d,t.fft=l.fft1d,t.ifft=l.ifft1d,t}).call(p)}));const $={"1H":267522187.44,"2H":41065e3,"3H":285350800,"3He":-203789e3,"7Li":103962e3,"13C":67282840,"14N":19331e3,"15N":-27116e3,"17O":-36264e3,"19F":251662e3,"23Na":70761e3,"27Al":69763e3,"29Si":-5319e4,"31P":108291e3,"57Fe":8681e3,"63Cu":71118e3,"67Zn":16767e3,"129Xe":-73997e3};function j(t,r,n){!function(t){let r=0,e=0;for(let n of t)for(let t of n.spectra){if(n.ntuples&&n.ntuples.symbol?(!r&&t.observeFrequency&&(r=t.observeFrequency),!e&&t.shiftOffsetVal&&(e=t.shiftOffsetVal)):(r=t.observeFrequency,e=t.shiftOffsetVal),r&&t.xUnits&&t.xUnits.toUpperCase().includes("HZ")){t.xUnits="PPM",t.xFactor=t.xFactor/r,t.firstX=t.firstX/r,t.lastX=t.lastX/r,t.deltaX=t.deltaX/r;for(let e=0;e<t.data.x.length;e++)t.data.x[e]/=r}if(e){let r=t.firstX-e;t.firstX=t.firstX-r,t.lastX=t.lastX-r;for(let e=0;e<t.data.x.length;e++)t.data.x[e]-=r}if(r&&n.ntuples&&n.ntuples.symbol&&n.ntuples.nucleus){let e="",a=n.ntuples.symbol.indexOf(t.pageSymbol);if(n.ntuples.units&&n.ntuples.units[a]&&(e=n.ntuples.units[a]),"PPM"!==e){if(0!==a)throw Error("Not sure about this ntuples format");let e=$[n.ntuples.nucleus[0]],o=$[n.ntuples.nucleus[1]];if(!e||!o)throw Error("Problem with determination of gyromagnetic ratio");let i=e/o*r;t.pageValue/=i}}}}(t);for(let a of t){if(Object.keys(a.ntuples).length>0){let t=[],r=Object.keys(a.ntuples);for(let e=0;e<r.length;e++){let n=r[e],o=a.ntuples[n];for(let r=0;r<o.length;r++)t[r]||(t[r]={}),t[r][n]=o[r]}a.ntuples=t}a.twoD&&n.wantXY&&(m(a,n),y(r,"Finished countour plot calculation",n),n.keepSpectra||delete a.spectra),n.chromatogram&&(a.spectra.length>1?e(a):w(a),y(r,"Finished chromatogram calculation",n))}}function P(t,r,e){let n=-1,a=-1,o="",i="";if(e.indexOf("++")>0)o=e.replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),i=e.replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");else{o=(e=e.replace(/[^a-zA-Z]/g,"")).charAt(0),i=e.charAt(1),r.variables={};for(let n of e){let e=t.ntuples.symbol.indexOf(n);if(-1===e)throw Error("Symbol undefined: "+n);r.variables[n]={};for(let a in t.ntuples)t.ntuples[a][e]&&(r.variables[n][a.replace(/^var/,"")]=t.ntuples[a][e])}}n=t.ntuples.symbol.indexOf(o),a=t.ntuples.symbol.indexOf(i),-1===n&&(n=0),-1===a&&(a=0),t.ntuples.first&&(t.ntuples.first.length>n&&(r.firstX=t.ntuples.first[n]),t.ntuples.first.length>a&&(r.firstY=t.ntuples.first[a])),t.ntuples.last&&(t.ntuples.last.length>n&&(r.lastX=t.ntuples.last[n]),t.ntuples.last.length>a&&(r.lastY=t.ntuples.last[a])),t.ntuples.vardim&&t.ntuples.vardim.length>n&&(r.nbPoints=t.ntuples.vardim[n]),t.ntuples.factor&&(t.ntuples.factor.length>n&&(r.xFactor=t.ntuples.factor[n]),t.ntuples.factor.length>a&&(r.yFactor=t.ntuples.factor[a])),t.ntuples.units&&(t.ntuples.units.length>n&&(t.ntuples.varname&&t.ntuples.varname[n]?r.xUnits=`${t.ntuples.varname[n]} [${t.ntuples.units[n]}]`:r.xUnits=t.ntuples.units[n]),t.ntuples.units.length>a&&(t.ntuples.varname&&t.ntuples.varname[a]?r.yUnits=`${t.ntuples.varname[a]} [${t.ntuples.units[a]}]`:r.yUnits=t.ntuples.units[a]))}function R(t){t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1)}const U=/[ \t]*,[ \t]*/;class q{}const V={keepRecordsRegExp:/^$/,canonicDataLabels:!0,canonicMetadataLabels:!1,dynamicTyping:!0,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5,profiling:!1};t.convert=function(t,r={}){(r=Object.assign({},V,r)).wantXY=!r.withoutXY,r.start=Date.now();let e=[],l={profiling:!!r.profiling&&[],logs:[],entries:[]},f={children:[]},c=f,h=[],p=new q;if("string"!=typeof t)throw new TypeError("the JCAMP should be a string");y(l,"Before split to LDRS",r);let d=t.replace(/[\r\n]+##/g,"\n##").split("\n##");y(l,"Split to LDRS",r),d[0]&&(d[0]=d[0].replace(/^[\r\n ]*##/,""));for(let t of d){let f=t.indexOf("="),d=f>0?t.substring(0,f):t,v=f>0?t.substring(f+1).trim():"",g=d.replace(/[_ -]/g,"").toUpperCase();if("DATATABLE"===g){let t=v.indexOf("\n");if(-1===t&&(t=v.indexOf("\r")),t>0){let r=v.substring(0,t).split(/[ ,;\t]+/);P(c,p,r[0]),p.datatable=r[0],r[1]&&r[1].indexOf("PEAKS")>-1?g="PEAKTABLE":r[1]&&(r[1].indexOf("XYDATA")||r[0].indexOf("++")>0)&&(g="XYDATA",p.deltaX=(p.lastX-p.firstX)/(p.nbPoints-1))}}if("XYDATA"!==g)if("PEAKTABLE"!==g)if("PEAKASSIGNMENTS"!==g){if("TITLE"===g){let t=c;t.children||(t.children=[]),c={spectra:[],ntuples:{},info:{},meta:{}},t.children.push(c),h.push(t),e.push(c),c.title=v}else"DATATYPE"===g?(c.dataType=v,v.toLowerCase().indexOf("nd")>-1&&(c.twoD=!0)):"NTUPLES"===g?v.toLowerCase().indexOf("nd")>-1&&(c.twoD=!0):"DATACLASS"===g?c.dataClass=v:"XUNITS"===g?p.xUnits=v:"YUNITS"===g?p.yUnits=v:"FIRSTX"===g?p.firstX=parseFloat(v):"LASTX"===g?p.lastX=parseFloat(v):"FIRSTY"===g?p.firstY=parseFloat(v):"LASTY"===g?p.lastY=parseFloat(v):"NPOINTS"===g?p.nbPoints=parseFloat(v):"XFACTOR"===g?p.xFactor=parseFloat(v):"YFACTOR"===g?p.yFactor=parseFloat(v):"MAXX"===g?p.maxX=parseFloat(v):"MINX"===g?p.minX=parseFloat(v):"MAXY"===g?p.maxY=parseFloat(v):"MINY"===g?p.minY=parseFloat(v):"DELTAX"===g?p.deltaX=parseFloat(v):".OBSERVEFREQUENCY"===g||"$SFO1"===g?p.observeFrequency||(p.observeFrequency=parseFloat(v)):".OBSERVENUCLEUS"===g?p.xType||(c.xType=v.replace(/[^a-zA-Z0-9]/g,"")):"$OFFSET"===g?(c.shiftOffsetNum=0,p.shiftOffsetVal||(p.shiftOffsetVal=parseFloat(v))):"$REFERENCEPOINT"===g||("VARNAME"===g?c.ntuples.varname=v.split(U):"SYMBOL"===g?c.ntuples.symbol=v.split(U):"VARTYPE"===g?c.ntuples.vartype=v.split(U):"VARFORM"===g?c.ntuples.varform=v.split(U):"VARDIM"===g?c.ntuples.vardim=o(v.split(U)):"UNITS"===g?c.ntuples.units=v.split(U):"FACTOR"===g?c.ntuples.factor=o(v.split(U)):"FIRST"===g?c.ntuples.first=o(v.split(U)):"LAST"===g?c.ntuples.last=o(v.split(U)):"MIN"===g?c.ntuples.min=o(v.split(U)):"MAX"===g?c.ntuples.max=o(v.split(U)):".NUCLEUS"===g?(c.ntuples&&(c.ntuples.nucleus=v.split(U)),c.twoD&&(c.yType=v.split(U)[0])):"PAGE"===g?(p.page=v.trim(),p.pageValue=parseFloat(v.replace(/^.*=/,"")),p.pageSymbol=p.page.replace(/[=].*/,"")):"RETENTIONTIME"===g?p.pageValue=parseFloat(v):n(g)?p[a(g)]=v:"SAMPLEDESCRIPTION"===g?p.sampleDescription=v:"END"===g&&(c=h.pop()));if(c&&c.info&&c.meta&&g.match(r.keepRecordsRegExp)){let t,e,n=v.trim();if(d.startsWith("$")?(e=r.canonicMetadataLabels?g.substring(1):d.substring(1),t=c.meta):(e=r.canonicDataLabels?g:d,t=c.info),r.dynamicTyping){let t=Number.parseFloat(n);Number.isNaN(t)||(n=t)}t[e]?(Array.isArray(t[e])||(t[e]=[t[e]]),t[e].push(n)):t[e]=n}}else r.wantXY&&(v.match(/.*(XYA).*/)&&u(p,v),c.spectra.push(p),p=new q);else r.wantXY&&(R(p),s(p,v,l),c.spectra.push(p),p=new q);else r.wantXY&&(R(p),v.match(/.*\+\+.*/)?(p.deltaX||(p.deltaX=(p.lastX-p.firstX)/(p.nbPoints-1)),i(p,v)):s(p,v,l),c.spectra.push(p),p=new q)}return y(l,"Finished parsing",r),j(e,l,r),y(l,"Total time",r),l.entries=f.children,l.flatten=e,l},t.createTree=function(t,r={}){const{flatten:e=!1}=r;if("string"!=typeof t)throw new TypeError("the JCAMP should be a string");let n,a=t.split(/[\r\n]+/),o=[],i=[],l=[],f=0,s=t.includes("## ");for(let t=0;t<a.length;t++){let r=a[t],e=s?r.replace(/ /g,""):r;if("##NTUPLES"===e.substring(0,9)&&f++,"##TITLE"===e.substring(0,7)){let l=[e.substring(8).trim()];for(let r=t+1;r<a.length&&!a[r].startsWith("##");r++)l.push(a[r].trim());i.push({title:l.join("\n"),jcamp:r+"\n",children:[]}),n=i[i.length-1],o.push(n)}else if("##END"===e.substring(0,5)&&0===f){n.jcamp+=r+"\n";let t=i.pop();0!==i.length?(n=i[i.length-1],n.children.push(t)):(n=void 0,l.push(t))}else if(n&&n.jcamp){n.jcamp+=r+"\n";let t=e.match(/^##(.*?)=(.+)/);if(t){"DATATYPE"===t[1].replace(/[ _-]/g,"").toUpperCase()&&(n.dataType=t[2].trim())}}"##END"===e.substring(0,5)&&f>0&&f--}return e?(o.forEach(t=>{t.children=void 0}),o):l},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=jcampconverter.min.js.map

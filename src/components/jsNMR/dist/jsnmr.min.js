/*! jsNMR 1.1.0 | (c) 2014 Norman Pellet | http://github.com/NPellet/jsNMR/copyright.txt */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a):b(a)}(window,function(a){var b=function(a,b,c){function d(a,b){var d=[];for(var e in b)d.push($.get(b[e]).then(function(a){return c(a)}));a.divLoading=$("<div />").css({width:a.getDom().width(),height:a.getDom().height(),position:"absolute",backgroundColor:"rgba(200, 200, 200, 0.5)",textAlign:"center",lineHeight:a.getDom().height()+"px",fontSize:"2em",border:"1px solid #c0c0c0"}).html("Loading..."),a.getDom().prepend(a.divLoading),$.when.apply($,d).then(function(){var c=0;for(e in b)b[e]=arguments[c],c++;a.divLoading.remove(),o(a,b)})}function e(a,b,c){for(var d=0,f=0,g=a.integrals[b].length;g>f;f++)d=Math.max(d,a.integrals[b][f].lastSum);for(var f=0,g=a.integrals[b].length;g>f;f++)a.integrals[b][f].ratio=a.integrals[b][f].lastSum/d,a.integrals[b][f].setPosition(),a.integrals[b][f].data.label[0].text=a.integralBasis?Math.round(a.integrals[b][f].lastSum/a.integralBasis*100)/100:1,a.integrals[b][f].setLabelPosition(0),a.integrals[b][f].setLabelText(0);a.isSymmetric()&&!c&&e(a,k(a,b),!0)}function f(a,b,c){var d=b.getFromData("pos"),e=b.getFromData("pos2"),f=c.getFromData("pos"),g=c.getFromData("pos2");f.x=d.y,f.y=d.x,g.x=e.y,g.y=e.x}function g(a,b,c){if(m(a,b,c).then(function(a){c.integral=a,a.data.pos=c.getFromData("pos"),a.data.pos2=c.getFromData("pos2")}),a.isSymmetric()){var d=k(a,b);l(a,d).then(function(b){c.syncTo=b,b.syncTo=c,b.data.pos={},b.data.pos2={},b.draw(),f(a,c,c.syncTo),b.redrawImpl(),m(a,d).then(function(a){b.integral=a,a.data.pos=b.getFromData("pos"),a.data.pos2=b.getFromData("pos2")})})}}function h(a,b,c){c.integral&&(c.integral.setPosition(),c.syncTo&&(f(a,c,c.syncTo),c.syncTo.redrawImpl(),c.syncTo.integral&&c.syncTo.integral.setPosition()),e(a,b))}function i(a,b,c){c.integral&&(c.integral.setPosition(),c.syncTo&&(f(a,c,c.syncTo),c.syncTo.redrawImpl(),c.syncTo.integral.setPosition()),e(a,b))}function j(a,b,c){c.integral&&(c.integral.kill(),a.integrals[b].splice(a.integrals[b].indexOf(c.integral),1)),c.syncTo&&(c.syncTo.kill(),a.integrals[k(b)].splice(a.integrals[k(a,b)].indexOf(c.syncTo.integral),1)),e(a,b)}function k(a,b){return"x"==b?"y":"y"==b?"x":console.error("Mode not recognized")}function l(a,b){return a.graphs[b].makeShape($.extend(!0,{},a.nmrSignal1dOptions[b]),{})}function m(a,b){return a.graphs[b].makeShape($.extend(!0,{},a.nmrIntegralOptions[b]),{}).then(function(c){return a.integrals[b].push(c),c.draw(),c})}function n(a,b){return{shapeOptions:{onCreate:function(){g(a,b,this)},onResize:function(){h(a,b,this)},onMove:function(){i(a,b,this)},onRemove:function(){j(a,b,this)}}}}function o(a,b){switch(a.data=b,a.getMode()){case"1d":a.options.dom.append("<div />"),a.makeGraphs1D();break;case"2d":a.options.dom.append('<table cellpadding="0" cellspacing="0" class="nmr-wrapper"><tr><td></td><td class="nmr-1d nmr-1d-x nmr-main"></td></tr><tr class="nmr-main"><td class="nmr-1d nmr-1d-y"></td><td class="nmr-2d"></td></tr></table>'),a.makeGraphs2D()}}var p={mode:"1d",molecule:!1,urls:{}},q=function(a){this.options=$.extend(!0,{},p,a);var b={};switch(this.options.mode){case"2d":this.options.urls.twoD=this.options.urls.twoD||this.options.urls.url,this.options.urls.x=this.options.urls.x||this.options.urls.oneD,this.options.urls.y=this.options.urls.y||this.options.urls.oneD||(this.options.symmetric?this.options.urls.x:!1),b.twoD=this.options.urls.twoD,this.options.urls.x&&(b.x=this.options.urls.x),this.options.urls.y&&(b.y=this.options.urls.y),this.graphs={x:null,y:null,_2d:null},this.integrals={x:[],y:[],_2d:[]};break;case"1d":this.options.urls.oneD=this.options.url||this.options.urls.oneD||this.options.urls.x,b.x=this.options.urls.oneD,this.graphs={x:null},this.integrals={x:[]}}d(this,b),this.nmrIntegralOptions={x:{type:"nmrintegral",fillColor:"transparent",strokeColor:"rgba(100, 0, 0, 0.5)",strokeWidth:"1px",label:{position:{},text:1,color:"red",anchor:"middle"},shapeOptions:{locked:!0}}},this.isSymmetric()&&(this.nmrIntegralOptions.y=$.extend(!0,{},this.nmrIntegralOptions.x),this.nmrIntegralOptions.y.shapeOptions.axis="y"),this.nmrSignal1dOptions={x:{url:"src/shape.1dnmr",strokeColor:"green",strokeWidth:2,shapeOptions:{horizontal:!0,forcedCoords:{y:"20px"},bindable:!0,axis:"x"}}},this.isSymmetric()&&(this.nmrSignal1dOptions.y=$.extend(!0,{},this.nmrSignal1dOptions.x),this.nmrSignal1dOptions.y.shapeOptions.axis="y"),this.nmrSignal1dOptions.x=$.extend(!0,{},this.nmrSignal1dOptions.x,n(this,"x")),this.nmrSignal1dOptions.y=$.extend(!0,{},this.nmrSignal1dOptions.x,n(this,"y")),this.nmrSignal2dOptions={url:"src/shape.2dnmr",strokeColor:"green",strokeWidth:2,shapeOptions:{horizontal:!0,forcedCoords:{y:"20px"},bindable:!0,axis:"x"}}};return q.prototype.isSymmetric=function(){return this.options.symmetric||!1},q.prototype.getMode=function(){return this.options.mode},q.prototype.getDom=function(){return this.options.dom},q.prototype.makeGraphs2D=function(){var b=this;this.graphs._2d=new a(this.getDom().find(".nmr-2d").get(0),{close:{left:!1,top:!1,right:!1},paddingBottom:0,paddingTop:0,paddingLeft:0,paddingRight:0,onAnnotationChange:function(a,b){if("rect"==a.type){var c=a.pos;c.x=(c.x+a.pos2.x)/2,c.y=(c.y+a.pos2.y)/2,this.makeShape({type:"cross",pos:c,strokeColor:"red",strokeWidth:3,shapeOptions:{length:20,locked:!0}}).then(function(a){a.draw(),a.redrawImpl()}),b.kill()}},plugins:{"graph.plugin.zoom":{zoomMode:"xy",onZoomStart:function(a,c,d,e){b.graphs.x._pluginExecute("graph.plugin.zoom","onMouseDown",[b.graphs.x,c,d,e,!0]),b.graphs.y._pluginExecute("graph.plugin.zoom","onMouseDown",[b.graphs.y,c,d,e,!0])},onZoomMove:function(a,c,d,e){b.graphs.x._pluginExecute("graph.plugin.zoom","onMouseMove",[b.graphs.x,c,d,e,!0]),b.graphs.y._pluginExecute("graph.plugin.zoom","onMouseMove",[b.graphs.y,c,d,e,!0])},onZoomEnd:function(a,c,d,e){b.graphs.x._pluginExecute("graph.plugin.zoom","onMouseUp",[b.graphs.x,c,d,e,!0]),b.graphs.y._pluginExecute("graph.plugin.zoom","onMouseUp",[b.graphs.y,c,d,e,!0])},onDblClick:function(a,c,d,e){b.graphs.y._pluginExecute("graph.plugin.zoom","onDblClick",[b.graphs.y,a,c,{mode:"total"},e,!0]),b.graphs.x._pluginExecute("graph.plugin.zoom","onDblClick",[b.graphs.x,a,c,{mode:"total"},e,!0])}},"graph.plugin.shape":{type:"rect",fillColor:"rgba(100, 0, 0, 0.3)",shapeOptions:{bindable:!1}}},dblclick:{type:"plugin",plugin:"graph.plugin.zoom",options:{mode:"total"}},pluginAction:{"graph.plugin.zoom":{shift:!1,ctrl:!1},"graph.plugin.shape":{shift:!0,ctrl:!1}}}),this.graphs.x=new a(this.getDom().find(".nmr-1d-x").get(0),{close:{left:!1,top:!1,right:!1},paddingBottom:0,paddingTop:0,paddingLeft:0,paddingRight:0,onAnnotationChange:function(a,c){if("src/shape.1dnmr"==a.url)b.integralBasis||(b.integralBasis=c.integral.lastSum);else if("nmrintegral"==a.type&&b.integralBasis){var d=parseFloat(c.data.label[0].text);0!=d&&(b.integralBasis=c.lastSum/d)}e(b,"x"),b.isSymmetric()&&e(b,"y")},plugins:{"graph.plugin.zoom":{zoomMode:"x",onZoomStart:function(a,c,d,e){b.graphs._2d._pluginExecute("graph.plugin.zoom","onMouseDown",[b.graphs._2d,c,void 0,e,!0])},onZoomMove:function(a,c,d,e){b.graphs._2d._pluginExecute("graph.plugin.zoom","onMouseMove",[b.graphs._2d,c,void 0,e,!0])},onZoomEnd:function(a,c,d,e){b.graphs._2d._pluginExecute("graph.plugin.zoom","onMouseUp",[b.graphs._2d,c,void 0,e,!0])},onDblClick:function(a,c,d,e){b.graphs._2d._pluginExecute("graph.plugin.zoom","onDblClick",[b.graphs._2d,a,c,{mode:"xtotal"},e,!0])}},"graph.plugin.shape":b.nmrSignal1dOptions.x},dblclick:{type:"plugin",plugin:"graph.plugin.zoom",options:{mode:"total"}},pluginAction:{"graph.plugin.zoom":{shift:!1,ctrl:!1},"graph.plugin.shape":{shift:!0,ctrl:!1}}}),this.graphs.y=new a(this.getDom().find(".nmr-1d-y").get(0),{close:{left:!1,top:!1,right:!1},plugins:{"graph.plugin.zoom":{zoomMode:"y",onZoomStart:function(a,c,d,e){b.graphs._2d._pluginExecute("graph.plugin.zoom","onMouseDown",[b.graphs._2d,void 0,d,e,!0])},onZoomMove:function(a,c,d,e){b.graphs._2d._pluginExecute("graph.plugin.zoom","onMouseMove",[b.graphs._2d,void 0,d,e,!0])},onZoomEnd:function(a,c,d,e){b.graphs._2d._pluginExecute("graph.plugin.zoom","onMouseUp",[b.graphs._2d,void 0,d,e,!0])},onDblClick:function(a,c,d,e){b.graphs._2d._pluginExecute("graph.plugin.zoom","onDblClick",[b.graphs._2d,a,c,{mode:"ytotal"},e,!0])}},"graph.plugin.shape":b.nmrSignal1dOptions.y},dblclick:{type:"plugin",plugin:"graph.plugin.zoom",options:{mode:"total"}},pluginAction:{"graph.plugin.zoom":{shift:!1,ctrl:!1},"graph.plugin.shape":{shift:!0,ctrl:!1}},wheel:{type:"plugin",plugin:"graph.plugin.zoom",options:{direction:"x"}},paddingBottom:0,paddingTop:0,paddingLeft:0,paddingRight:0});var c=this.graphs.x.newSerie("seriex").setLabel("My serie").autoAxis().setData(this.data.x.spectra[0].data[0]);c.getYAxis().setDisplay(!1).togglePrimaryGrid(!1).toggleSecondaryGrid(!1),c.getXAxis().flip(!0).setLabel("ppm").togglePrimaryGrid(!1).toggleSecondaryGrid(!1).setTickPosition("outside");var d=this.graphs.y.newSerie("seriey",{flip:!0}).setLabel("My serie").setXAxis(this.graphs.y.getBottomAxis()).setYAxis(this.graphs.y.getRightAxis()).setData(this.data.y.spectra[0].data[0]);d.getYAxis().setLabel("ppm").togglePrimaryGrid(!1).toggleSecondaryGrid(!1).flip(!0).setTickPosition("outside"),d.getXAxis().togglePrimaryGrid(!1).toggleSecondaryGrid(!1).setDisplay(!1).flip(!0);var f=this.graphs._2d.newSerie("serie2d",{},"contour").setLabel("My serie").autoAxis().setData(this.data.twoD.contourLines);f.getXAxis().forceMin(c.getXAxis().getMinValue()),f.getXAxis().forceMax(c.getXAxis().getMaxValue()),f.getYAxis().forceMin(d.getYAxis().getMinValue()),f.getYAxis().forceMax(d.getYAxis().getMaxValue()),f.getXAxis().setLabel("ppm").togglePrimaryGrid(!1).toggleSecondaryGrid(!1).setDisplay(!1).flip(!0),f.getYAxis().togglePrimaryGrid(!1).toggleSecondaryGrid(!1).setDisplay(!1).flip(!0),this.graphs.y.redraw(),this.graphs.y.drawSeries(),this.graphs.x.redraw(),this.graphs.x.drawSeries(),this.graphs._2d.redraw(),this.graphs._2d.drawSeries()},q.prototype.makeGraphs1D=function(){var b=this;this.graphs.x=new a(this.getDom().children().get(0),{close:{left:!1,top:!1,right:!1},paddingBottom:0,paddingTop:0,paddingLeft:0,paddingRight:0,onAnnotationChange:function(a,c){if("nmrsignal1d"==a.type)b.integralBasis||(b.integralBasis=c.integral.lastSum);else if("nmrintegral"==a.type&&b.integralBasis){var d=parseFloat(c.data.label[0].text);0!=d&&(b.integralBasis=c.lastSum/d)}e(b,"x")},plugins:{"graph.plugin.zoom":{zoomMode:"x"},"graph.plugin.shape":this.nmrSignal1dOptions.x},dblclick:{type:"plugin",plugin:"graph.plugin.zoom",options:{mode:"total"}},pluginAction:{"graph.plugin.zoom":{shift:!1,ctrl:!1},"graph.plugin.shape":{shift:!0,ctrl:!1}}}),this.graphs.x.setHeight(500);var c=this.graphs.x.newSerie("seriex").setLabel("My serie").autoAxis().setData(this.data.x.spectra[0].data[0]);c.getYAxis().setDisplay(!1).togglePrimaryGrid(!1).toggleSecondaryGrid(!1),c.getXAxis().flip(!0).setLabel("ppm").togglePrimaryGrid(!1).toggleSecondaryGrid(!1).setTickPosition("outside"),this.graphs.x.redraw(),this.graphs.x.drawSeries()},q};if("function"==typeof define&&define.amd)define(["graph","assignation","jcampconverter"],function(a,c,d){return b(a,c,d)});else if(a){if(!(a.Graph&&a.Assignation&&a.JcampConverter))throw"Graph, Attribution or Jcamp is not defined";a.NMRHandler=b(a.Graph,a.Assignation,a.JcampConverter)}}),function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a):b(a)}("undefined"!=typeof window?window:this,function(a){"use strict";var b=function(a){return function(b,c){var d,e=!1,f=!1,g=!1,h=[],i=function(b,g){if(g.shiftKey){for(var h in c)c[h].lockShapes();e=!0,f=b,g.preventDefault(),g.stopPropagation()}var i=a(b).position(),j=parseFloat(b.getAttribute("width")||0),k=parseFloat(b.getAttribute("height")||0),l=parseFloat(b.getAttribute("x2")||0),m=parseFloat(b.getAttribute("y2")||0),n=parseFloat(b.getAttribute("x1")||0),o=parseFloat(b.getAttribute("y1")||0),p=i.left+j/2+Math.abs(l-n)/2,q=i.top+k/2+Math.abs(m-o)/2;d.setAttribute("display","block"),d.setAttribute("x1",p),d.setAttribute("x2",p),d.setAttribute("y1",q),d.setAttribute("y2",q)},j=function(a,b){if(e){var f=b.target;d.setAttribute("display","none"),f.classList.contains("bindable")?(g=b.target,e=!1,o()):e=!1;for(var h in c)c[h].unlockShapes()}},k=function(a){e&&(d.setAttribute("x2",a.clientX),d.setAttribute("y2",a.clientY))},l=function(a){n("highlight",a)},m=function(a){n("unhighlight",a)},n=function(a,b){for(var c=0,d=h.length;d>c;c++)(h[c][0]==b||h[c][1]==b)&&(h[c][0].element?h[c][0].element[a]():console.log("Manual"),h[c][1].element?h[c][1].element[a]():console.log("Manual"))},o=function(){h.push([f,g]),f=null,g=null},p=function(){b.on("mousedown",".bindable",function(a){i(this,a)}),b.on("mouseover",".bindable",function(){l(this)}),b.on("mouseout",".bindable",function(){m(this)}),b.on("mouseup",function(a){j(this,a)}),b.on("mousemove",function(a){k(a)})},q="http://www.w3.org/2000/svg",r=document.createElementNS(q,"svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttribute("xmlns",q),r.setAttribute("style","position: absolute"),r.setAttribute("width",b.width()),r.setAttribute("height",b.height()),r.setAttribute("pointer-events","none"),d=document.createElementNS(q,"line"),d.setAttribute("stroke","black"),r.appendChild(d),b.prepend(r),p()}};if("function"==typeof define&&define.amd)define(["jquery"],function(a){return b(a)});else if(a){if(!a.jQuery)throw"jQuery has not been loaded. Abort assignation initialization.";a.Assignation=b(a.jQuery)}});